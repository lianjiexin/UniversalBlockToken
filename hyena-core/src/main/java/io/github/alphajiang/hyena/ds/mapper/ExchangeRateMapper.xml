<!--

  ~ record the current exchange rate.
  -->

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.alphajiang.hyena.ds.mapper.ExchangeRateMapper">


    <update id="createExchangeRateTable" flushCache="true">
        create table if not exists t_exchange_rate (
        id bigint(20) not null auto_increment primary key,
        `symbol` varchar(128) not null,
        `source` varchar(128) not null,
        `dest` varchar(128) not null,
        `rate` decimal(20,2) not null default 1,
        `enable` boolean not null default false,
        `createTime` timestamp default now(),
        `updateTime` timestamp default now(),
        unique index t_exchange_rate_key(`symbol`)
        ) engine=InnoDB default charset=utf8mb4
    </update>

    <insert id="insertOrUpdate" parameterType="io.github.alphajiang.hyena.model.po.ExchangeRatePo">
        insert into t_exchange_rate(`symbol`, `source`, `dest`, `rate`,`enable`, createTime, updateTime)
        values (#{symbol}, #{source}, #{dest}, #{rate}, #{enable}, now(), now())
        on duplicate key update
        rate = #{rate},
        source = #{source},
        dest = #{dest},
        enable = #{enable},
        updateTime = now()
    </insert>
    
    <select id="getExchangeRate" resultType="io.github.alphajiang.hyena.model.po.ExchangeRatePo">
        select * from t_exchange_rate where `symbol`=#{symbol}
    </select>


    <update id="updateExchangeRate" >
        update t_exchange_rate set `source`=#{source},`dest`=#{dest},`rate`=#{rate},`enable`=#{enable},
        updateTime = now()
        where `symbol`=#{symbol}
    </update>
</mapper>